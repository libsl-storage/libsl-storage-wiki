# Определения и термины

- Программное обеспечение (ПО) – программа или множество программ, используемых для управления компьютером.

- Библиотека – сборник подпрограмм или объектов, используемых для разработки программного обеспечения.

- LibSL – язык спецификации компонентов программного обеспечения.

- Подсветка синтаксиса – выделение синтаксических конструкций текста с использованием различных цветов, шрифтов и начертаний. 

- Конечный автомат – абстрактная математическая модель, представленная в виде ориентированного графа, вершины котрого характеризуют текущее состояние автомата, а дуги между вершинами характеризуют возможные переходы между состояниями, осуществляемые в зависимости от входных данных.

- PAP (Password Authentication Protocol) – протокол аутентификации, предусматривающий отправку имени пользователя и пароля на сервер аутентификации.

- OAuth – протокол авторизации, обеспечивающий предоставление третьей стороне ограниченного доступа к защищённым ресурсам пользователя без передачи ей (третьей стороне) данных для аутентификации.

- FE (Frontend) – часть системы, отвечающая за принятие http- и https-запросов пользователей к домену, взаимодействие с BE и формирование графического пользовательского интерфейса.

- BE (Backend) – часть системы, реализующая ее бизнес-логику.

# Общие положения

Требуется реализовать сетевую систему хранения, отображения и редактирования спецификаций программных библиотек на языке LibSL. 

Система дожлна предоставлять пользователям следующие возможности:

- любой пользователь может осуществлять навигацию по каталогу загруженных в систему спецификаций на языке LibSL;

- любой пользователь может скачивать или просматривать имеющиеся в файловой системе файлы спецификаций;

- отображение спецификаций должно быть представлено в 2 вариантах:
  
  - текстовое содержание файла спецификации на языке LibSL с подсветкой синтаксиса;
  
  - визуализация конечных автоматов, описанных в файле спецификации при помощи синтаксической конструкции `automaton`;

- любой пользователь может авторизироваться;

- авторизованный пользователь может загружать новые файлы спецификации LibSL;
  
  - при загрузке для спецификаций должна задаваться метаинформация о специфицируемой библиотеке;
  
  - при загрузке спецификации должны пройти проверку на синтаксическую корректность;

# Требования, ограничения и допущения

## EPIC: Авторизация пользователей

Требуется реализовать возможность авторизации пользователя для дальнейшего разделения прав доступа.

Система авторизация должна служить для классификации пользователей:

- неавторизованный пользователь;

- авторизованный пользователь;

- суперпользователь.

### STORY: Интеграция сущности пользователя

Сущности пользователей должны храниться на стороне BE.

Сущность пользователя должна содержать следующую информацию:

- имя пользователя;

- имя учетной записи;

- адрес электронной почты;

- пароль;

- роль пользователя.

Каждая пользователь должен иметь уникальное имя учетной записи.

Каждая пользователь должен иметь уникальный адрес электронной почты.

На стороне BE требуются CRUD-средства для управления сущностями.

Пароли должны храниться в виде хэшей. Требуется возможность конфигурации методов шифрования на стороне BE. Требуется обеспечить возможность шифровки и дешифровки пароля при всех операциях его чтения или записи.

Все пользователи по умолчанию должны иметь роль `default`.

### STORY: Интеграция ролей пользователей

Роли должны определять набор привелегий, доступные пользователям.

Перечень ролей и их привелегий:

- обычный пользователь
  
  - изменение собственных пользовательских данных (кроме роли);
  
  - создание спецификаций;
  
  - изменение принадлежащих спецификаций;

- суперпользователь (админ)
  
  - изменение любых пользовательских данных
  
  - создание спецификаций;
  
  - изменение любых спецификаций.

### STORY: Регистрация новых пользователей

Требуется REST API контроллер на стороне BE для создания пользователей.

Контроллер должен принимать данные необходимые для создания пользователя (имя пользователя, имя учетной записи, адрес электронной почты, пароль).

При создании пользователя требуется явная валидация уникальности имени учетной записи регистрируемого пользователя.

При создании пользователя требуется явная валидация уникальности электронной почты регистрируемого пользователя.

При несоответствии вышеуказанным условиям или любой ошибке в процессе создания пользователя, в ответе на запрос о регистрации должна фигурировать причина неудачи.

При успешном создании пользователя в ответе на запрос о регистрации должен фигурировать jwt-токен для дальнейшей авторизации.

### STORY: Создание аккаунта суперпользователя

Генерация пользователя с ролью суперпользователя должна осуществляться при запуске системы, если он не было сгенерирован до этого.

Требуется возможность конфигурировать данные суперпользователя.

### STORY: Аутентификация пользователей по протоколу PAP

Требуется REST API контроллер на стороне BE для аутентификации пользоваьелей при помощи идентификатор + пароль.

В качестве идентификатора пользователя может выступать имя учетной записи пользователя или его адрес электронной почты.

В случае неуспешной аутентификации в ответе на запрос об аутентификации должна фигурировать причина неудачи.

В случае успешной аутентификации в ответе на запрос об аутентификации должен фигурировать jwt-токен для дальнейшей авторизации.

### STORY: Аутентификация пользвателя по протоколу OAuth

Требуется REST API контроллер на стороне BE для аутентификации пользоваьелей при помощи сторонних сервисов по протоколу OAuth2.

Доступные сервисы и настройки подключения к ним должны быть конфигурируемыми. 

Требуется REST API контроллер на стороне BE для получения списка доступных сервисов для авторизации при помощи OAuth.

В случае неуспешной аутентификации в ответе на запрос об аутентификации должна фигурировать причина неудачи.

В случае успешной аутентификации пользователя на сервисе и отсутствии пользователя с соответствующим адресом электронной почты на стороне BE в ответе на запрос об аутентификации должно фигурировать сообщение о том, что требуется регистрация пользователя, а также данные о пользователе, полученые при аутентификации на сервисе (имя пользователя, адрес электронной почты).

В случае успешной аутентификации в ответе на запрос об аутентификации должен фигурировать jwt-токен для дальнейшей авторизации.

### STORY: Отображение формы аутентификации

Требуется на стороне FE реализовать отображение для обеспечения возможности аутентификации пользователя.

Отображение должно содержать поле для ввода идентификатора пользователя.

Отображение должно содержать поле для ввода пароля пользователя.

Отображение должно содержать кнопку для передачи данных для аутентификации по протоколу PAP на сторону BE.

Отображение должно содержать набор кнопок, запрашивающий соответствующие данные сос тороны BE для аутентификации по протоколу OAuth. Каждая кнопка должна соответствовать одному из доступных сервисов для аутентификации. Список доступных сервисов должен приходить со стороны BE по соответствующему запросу.

Отображение должно содержать кнопку для перехода на страницу отображения формы регистрации.

При неуспешной аутентификации должно отображаться текстовое сообщение с причиной последней неудачи.

При аутентификации при помощи стороннего сервиса по протоколу OAuth и получении сообщении о необходимости создать нового пользователя, требуется навигироваться на страницу отображения формы регистрации; при этом поля формы регистрации должны быть заполнены на основе данных, полученных из ответа на запрос о неудачной аутентификации.

При успешной аутентификации должна осуществляться на последнию в истории навигации страницу, не являющейся страницей отображения формы аутентификации или формы регистрации, или на страницу отображения навигации по спецификациям.

### STORY: Отображение формы регистрации

Требуется на стороне FE реализовать отображение для обеспечения возможности регистрации пользователя.

Отображение должно содержать набор полей для ввода необходимой для создания на стороне BE пользователя (имя пользователя, имя учетной записи, адрес электронной почты, пароль).

Отображение должно содержать кнопку для передачи данных для создания пользователя на сторону BE.

Отображение должно содержать кнопку для перехода на страницу отображения формы аутентификации.

При неуспешной регистрации должно отображвться текстовое сообщение с причиной последней неудачи.

При успешной регистрации должна осуществляться навигация на последнию в истории навигации страницу, не являющейся страницей отображения формы аутентификации или формы регистрации, или на страницу отображения навигации по спецификациям.

## EPIC: Хранение спецификаций

### STORY: Интеграция сущности спецификации

Сущности спецификаций должны храниться на стороне BE.

Сущность спецификации должна содержать следующую информацию:

- идентификатор спецификации;

- название спецификации;

- идентификатор владельца спецификации;

- название специфицируемой библотеки;

- краткое описание специфицируемой библотеки;

- список тэгов.

На стороне BE требуются CRUD-средства для управления сущностями релизов спецификаций.

### STORY: Интеграция сущности релиза спецификации

Сущности релизов спецификаций должны храниться на стороне BE.

Сущность релиза спецификаии должна содержать следующую информацию:

- идентификатор связанной спецификации;

- название релиза;

- код релиза;

- порядковый индекс релиза;

- описание релиза;

- содержание libsl-файла со спецификацией;

- wiki-описание спецификации в формате markdown;

- описание конечных автоматов спецификации в формате dot.

На стороне BE требуются CRUD-средства для управления сущностями релизов спецификаций.

### STORY: Интеграция сущности права доступа к спефикации

Сущности прав доступа к спецификациям должны храниться на стороне BE.

Сущность права доступа к спецификации должна содержать следующую информацию:

- идентификатор связанного пользователя;

- идентификатор связанной спецификации;

- уровень доступа.

Уровень доступа должен определять один из следующих уровней:

- разрешено только чтение спецификации и ее релизов;

- разрешено чтение и изменение спецификации и ее релизов, а также создание новых релизов спецификаций.

На стороне BE требуются CRUD-средства для управления сущностями прав доступа к спецификациям.

### STORY: Создание спецификации

Требуется REST API контроллер на стороне BE для создания спецификации.

Требуется проверка авторизации пользователя. Пользователь должен обладать правами на создание спецификации.

Контроллер должен получать данные, необходимые для создания спецификации:

- название спецификации;

- название специфицируемой библотеки;

- краткое описание специфицируемой библотеки;

- список тэгов.

Все поля данных должны быть предоставлены.

Требуется проверка факта того, что название спецификации не является пустой строкой.

Требуется проверка факта того, что название специфицируемой библотеки не является пустой строкой.

Если вышеперечисленные условия соблюдены, на стороне BE должна быть сохранена новая сущность спецификации. Идентификатор владельца спецификации у новой сущности должен соответствовать идентификатору авторизованного для текущего запроса пользователя. Название спецификации, название специфицируемой библотеки, краткое описание специфицируемой библотеки, список тэгов у новой сущности должны соответствовать данным, полученные из текущего запроса. Данные новой сущности должны содержаться в ответе на текущий запрос.

При несоответствии вышеуказанным условиям или любой ошибке в процессе создания спецификации, в ответе на текущий запрос должна фигурировать причина неудачи.

### STORY: Изменение спецификации

Требуется REST API контроллер на стороне BE для изменения спецификации.

Требуется обеспечить возможность идентифицировать изменяемую спецификацию при помощи обязательного параметра пути контроллера.

Требуется проверка авторизации пользователя. Пользователь должен быть владельцем данной спецификации или обладать правом на изменение данной спецификации или правами на изменение любой спецификации.

Контроллер должен получать данные, необходимые для изменения спецификации:

- название спецификации;

- название специфицируемой библотеки;

- краткое описание специфицируемой библотеки;

- список тэгов.

Все поля данных могут быть не предоставлены.

Требуется проверка факта того, что название спецификации не является пустой строкой или не предоставлено.

Требуется проверка факта того, что название специфицируемой библотеки не является пустой строкой или или не предоставлено.

Если вышеперечисленные условия соблюдены, соответствующая сущность спецификации на стороне BE должна быть обновлена. В случае, если поле данных не предоставлено, то соответствующее поле данных сущности не должно меняться. Данные обновленной сущности должны содержаться в ответе на текущий запрос.

При несоответствии вышеуказанным условиям или любой ошибке в процессе создания спецификации, в ответе на текущий запрос должна фигурировать причина неудачи.

### STORY: Удаление спецификации

Требуется REST API контроллер на стороне BE для удаления спецификации.

Требуется обеспечить возможность идентифицировать удаляемую спецификацию при помощи обязательного параметра пути контроллера.

Требуется проверка авторизации пользователя. Пользователь должен быть владельцем данной спецификации или обладать правами на удаление любой спецификации.

Если вышеперечисленные условия соблюдены, соответствующая сущность спецификации на стороне BE должна быть удалена. Все связанные релизы специцикации также должны быть удалены. Все связанные права доступа к спецификации также должны быть удалены.

При несоответствии вышеуказанным условиям или любой ошибке в процессе создания спецификации, в ответе на текущий запрос должна фигурировать причина неудачи.

### STORY: Верификация libsl-файла

Требуется REST API контроллер на стороне BE для верификации libsl-спецификации.

Текст исходной libsl-верификации должен быть временно сохранен на стороне BE. Сохраненная спецификация и все сохраненные данные, ссылающиеся на данную спецификацию, должны быть удалены со стороны BE спустя неделю после ее сохранения.

Верификация заключается в статическом анализе содержимого исходного libsl-файла.

В случае, если статический анализ выявил ошибки в спецификации, в ответе на текущий запрос вместе с исходным текстом спецификации должен фигурировать список с информацией о найденых проблемах:

- место, в котором найдена ошибка (инервал строк и символов);

- сообщение ошибки.

Информация об ошибках должна быть также сохранена на стороне BE со ссылкой на сохраненный исходный текст спецификации.

В случае, если статический анализ не выявил ошибок, на основе исходной libsl-спецификации должны быть сгенерированы соответствующие отображения конечных автоматов спецификации в формате dot. 

Сгенерированные отображения конечных автоматов спецификации должны быть также сохранена на стороне BE со ссылкой на сохраненный исходный текст спецификации.

### STORY: Создание релиза спецификации

Требуется REST API контроллер на стороне BE для создания релиза спецификации.

Требуется обеспечить возможность идентифицировать спецификацию, связанную с создаваемым релизом при помощи обязательного параметра пути контроллера.

Требуется проверка авторизации пользователя. Пользователь должен быть владельцем связанной спецификации или обладать правом на изменение данной спецификации или правами на изменение любой спецификации.

Контроллер должен получать данные, необходимые для создания релиза спецификации:

- название релиза;

- код релиза;

- описание релиза;

- wiki-описание спецификации;

- файл libsl-спецификации.

Полe wiki-описание спецификации может быть не предоставлено. Все остальные поля должны быть предоставлены.

Требуется проверка факта, что поле названия релиза не является пустой строкой.

Требуется проверка факта, что поле кода релиза не является пустой строкой.

Требуется верификация libsl-спецификации. Если для данной спецификации имеются результаты верификации, повторная верификация не требуется, должны быть использованы результаты, сохраненные в ходе ранее проведенной верификации.

Если в ходе верификации были выявлены проблемы, в ответе на текущий запрос вместе с исходным текстом спецификации должен фигурировать список с информацией о найденых проблемах.

Если вышеперечисленные условия соблюдены, соответствующая сущность релиза спецификации на стороне BE должна быть обновлена. Название спецификации, название специфицируемой библотеки, краткое описание специфицируемой библотеки, список тэгов у новой сущности должны соответствовать данным, полученным из текущего запроса. Отображения конечных автоматов спецификаций в формате dot должны быть использованы из результатов верификации. Данные обновленной сущности должны содержаться в ответе на текущий запрос.

При несоответствии вышеуказанным условиям или любой ошибке в процессе создания спецификации, в ответе на текущий запрос должна фигурировать причина неудачи.

### STORY: Изменение релиза спецификации

Требуется REST API контроллер на стороне BE для изменения релиза спецификации.

Требуется обеспечить возможность идентифицировать изменяемый релиз спецификации при помощи обязательного параметра пути контроллера.

Требуется проверка авторизации пользователя. Пользователь должен быть владельцем связанной спецификации или обладать правом на изменение данной спецификации или правами на изменение любой спецификации.

Контроллер должен получать данные, необходимые для изменения релиза спецификации:

- название релиза;

- код релиза;

- описание релиза;

- wiki-описание спецификации;

- файл libsl-спецификации.

Все поля могут быть не предоставлены.

Требуется проверка факта, что поле названия релиза не является пустой строкой или не предоставлено.

Требуется проверка факта, что поле кода релиза не является пустой строкой или не предоставлено.

В случае, если предоставлен файл libsl-спецификации, требуется ее верификация. Если для данной спецификации имеются результаты верификации, повторная верификация не требуется, должны быть использованы результаты, сохраненные в ходе ранее проведенной верификации.

Если в ходе верификации были выявлены проблемы, в ответе на текущий запрос вместе с исходным текстом спецификации должен фигурировать список с информацией о найденых проблемах.

Если вышеперечисленные условия соблюдены, на стороне BE должна быть сохранена новая сущность спецификации. Идентификатор владельца спецификации у новой сущности должен соответствовать идентификатору авторизованного для текущего запроса пользователя. Название спецификации, название специфицируемой библотеки, краткое описание специфицируемой библотеки, список тэгов у новой сущности должны соответствовать данным, полученным из текущего запроса. Отображения конечных автоматов спецификаций в формате dot должны быть использованы из результатов верификации. Данные новой сущности должны содержаться в ответе на текущий запрос.

При несоответствии вышеуказанным условиям, ошибках верификаии или любой ошибке в процессе изменения спецификации, в ответе на текущий запрос должна фигурировать причина неудачи.

### STORY: Удаление релиза спецификации

Требуется REST API контроллер на стороне BE для удаления релиза спецификации.

Требуется обеспечить возможность идентифицировать удаляемый релиз спецификации при помощи обязательного параметра пути контроллера.

Требуется проверка авторизации пользователя. Пользователь должен быть владельцем данной спецификации или обладать правами на удаление любой спецификации.

Если вышеперечисленные условия соблюдены, соответствующая сущность релиза спецификации на стороне BE должна быть удалена. 

При несоответствии вышеуказанным условиям или любой ошибке в процессе создания спецификации, в ответе на текущий запрос должна фигурировать причина неудачи.

## EPIC: Просмотр спецификаций

### STORY: Отображение мета-информации спецификации

### STORY: Отображение содержимого спецификаций

### STORY: Отображение визуализации конечных автоматов спецификаций

### STORY: Отображение подсветка синтаксических конструкций LibSL

## EPIC: Развертывание системы

### STORY: Создание docker-compose инфраструктуры

На данный момент планируется деление проекта на три контейнера:

- БД

- Фронтэнд - веб-сервер

- Бэкэнд - реализация бизнес-логики

Для обеспечения взаимодействия контейнеров между собой планируется использование двух внутренних docker-сетей:

- БД-бэкэнд

- бэкэнд-фронтэнд

Следует отметить, что контейнер с веб-сервером должен иметь доступ к внешней сети для протоколов http/https.

### STORY: Настройка веб-сервера

Необходимо обеспечить как сборку проекта с фронтэндом, так и развёртывание артефактов сборки (сайт) на веб-сервере (e.g. Nginx). 

Так как требуется обеспечить подключение как с использованием http, так и с использованием https, необходимо озаботиться сертификатами (использовать let's encrypt). 

### STORY: Настройка бэкэнда

Необходимо обеспечить сборку бэкэнда с использованием выбранной системы сборки (e.g. Gradle) и запуском полученного в результате сборки артефакта.

### STORY: Настройка БД

Необходимо настроить запуск контейнера с БД (e.g. Postgres) с сохранением данных в volume и первичной инициализацией при отсутствии данных (пустом volume). Данные для доступа к БД будут находиться во внешнем .conf-файле и записываться в глобальные переменные бэкэнд-контейнера при его запуске.

### STORY: Настроить CI

В рамках реализации CI необходимо настроить автоматический запуск автотестов при появлении MR или коммите в main и develop-ветки.

### STORY: Настроить CD

Необходимо настроить автосборку контейнера и его выгрузку в docker registry для последующего автоматического обновления на конечном сервере с импользованием watchtower-контейнера.
