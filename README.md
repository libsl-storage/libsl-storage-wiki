# Определения и термины

- Программное обеспечение (ПО) – программа или множество программ, используемых для управления компьютером.

- Библиотека – сборник подпрограмм или объектов, используемых для разработки программного обеспечения.

- LibSL – язык спецификации компонентов программного обеспечения.

- Подсветка синтаксиса – выделение синтаксических конструкций текста с использованием различных цветов, шрифтов и начертаний. 

- Конечный автомат – абстрактная математическая модель, представленная в виде ориентированного графа, вершины котрого характеризуют текущее состояние автомата, а дуги между вершинами характеризуют возможные переходы между состояниями, осуществляемые в зависимости от входных данных.

- PAP (Password Authentication Protocol) – протокол аутентификации, предусматривающий отправку имени пользователя и пароля на сервер аутентификации.

- OAuth – протокол авторизации, обеспечивающий предоставление третьей стороне ограниченного доступа к защищённым ресурсам пользователя без передачи ей (третьей стороне) данных для аутентификации.

- FE (Frontend) – часть системы, отвечающая за принятие http- и https-запросов пользователей к домену, взаимодействие с BE и формирование графического пользовательского интерфейса.

- BE (Backend) – часть системы, реализующая ее бизнес-логику.

# Общие положения

Требуется реализовать сетевую систему хранения, отображения и редактирования спецификаций программных библиотек на языке LibSL. 

Система дожлна предоставлять пользователям следующие возможности:

- любой пользователь может осуществлять навигацию по каталогу загруженных в систему спецификаций на языке LibSL;

- любой пользователь может скачивать или просматривать имеющиеся в файловой системе файлы спецификаций;

- отображение спецификаций должно быть представлено в 2 вариантах:
  
  - текстовое содержание файла спецификации на языке LibSL с подсветкой синтаксиса;
  
  - визуализация конечных автоматов, описанных в файле спецификации при помощи синтаксической конструкции `automaton`;

- любой пользователь может авторизироваться;

- авторизованный пользователь может загружать новые файлы спецификации LibSL;
  
  - при загрузке для спецификаций должна задаваться метаинформация о специфицируемой библиотеке;
  
  - при загрузке спецификации должны пройти проверку на синтаксическую корректность;

# Требования, ограничения и допущения

## EPIC: Авторизация пользователей

Требуется реализовать возможность авторизации пользователя для дальнейшего разделения прав доступа.

Система авторизация должна служить для классификации пользователей:

- неавторизованный пользователь;

- авторизованный пользователь;

- суперпользователь.

### STORY: Интеграция сущности пользователя

Сущности пользователей должны храниться на стороне BE.

Сущность пользователя должна содержать следующую информацию:

- имя пользователя;

- имя учетной записи;

- адрес электронной почты;

- пароль;

- роль пользователя.

Каждая пользователь должен иметь уникальное имя учетной записи.

Каждая пользователь должен иметь уникальный адрес электронной почты.

На стороне BE требуются CRUD-средства для управления сущностями.

Пароли должны храниться в виде хэшей. Требуется возможность конфигурации методов шифрования на стороне BE. Требуется обеспечить возможность шифровки и дешифровки пароля при всех операциях его чтения или записи.

Все пользователи по умолчанию должны иметь роль `default`.

### STORY: Интеграция ролей пользователей

Роли должны определять набор привелегий, доступные пользователям.

Перечень ролей и их привелегий:

- обычный пользователь
  
  - изменение собственных пользовательских данных (кроме роли);
  
  - создание спецификаций;
  
  - изменение принадлежащих спецификаций;

- суперпользователь (админ)
  
  - изменение любых пользовательских данных
  
  - создание спецификаций;
  
  - изменение любых спецификаций.

### STORY: Регистрация новых пользователей

Требуется REST API контроллер на стороне BE для создания пользователей.

Контроллер должен принимать данные необходимые для создания пользователя (имя пользователя, имя учетной записи, адрес электронной почты, пароль).

При создании пользователя требуется явная валидация уникальности имени учетной записи регистрируемого пользователя.

При создании пользователя требуется явная валидация уникальности электронной почты регистрируемого пользователя.

При несоответствии вышеуказанным условиям или любой ошибке в процессе создания пользователя, в ответе на запрос о регистрации должна фигурировать причина неудачи.

При успешном создании пользователя в ответе на запрос о регистрации должен фигурировать jwt-токен для дальнейшей авторизации.

### STORY: Создание аккаунта суперпользователя

Генерация пользователя с ролью суперпользователя должна осуществляться при запуске системы, если он не было сгенерирован до этого.

Требуется возможность конфигурировать данные суперпользователя.

### STORY: Аутентификация пользователей по протоколу PAP

Требуется REST API контроллер на стороне BE для аутентификации пользоваьелей при помощи идентификатор + пароль.

В качестве идентификатора пользователя может выступать имя учетной записи пользователя или его адрес электронной почты.

В случае неуспешной аутентификации в ответе на запрос об аутентификации должна фигурировать причина неудачи.

В случае успешной аутентификации в ответе на запрос об аутентификации должен фигурировать jwt-токен для дальнейшей авторизации.

### STORY: Аутентификация пользвателя по протоколу OAuth

Требуется REST API контроллер на стороне BE для аутентификации пользоваьелей при помощи сторонних сервисов по протоколу OAuth2.

Доступные сервисы и настройки подключения к ним должны быть конфигурируемыми. 

Требуется REST API контроллер на стороне BE для получения списка доступных сервисов для авторизации при помощи OAuth.

В случае неуспешной аутентификации в ответе на запрос об аутентификации должна фигурировать причина неудачи.

В случае успешной аутентификации пользователя на сервисе и отсутствии пользователя с соответствующим адресом электронной почты на стороне BE в ответе на запрос об аутентификации должно фигурировать сообщение о том, что требуется регистрация пользователя, а также данные о пользователе, полученые при аутентификации на сервисе (имя пользователя, адрес электронной почты).

В случае успешной аутентификации в ответе на запрос об аутентификации должен фигурировать jwt-токен для дальнейшей авторизации.

### STORY: Отображение формы аутентификации

Требуется на стороне FE реализовать отображение для обеспечения возможности аутентификации пользователя.

Отображение должно содержать поле для ввода идентификатора пользователя.

Отображение должно содержать поле для ввода пароля пользователя.

Отображение должно содержать кнопку для передачи данных для аутентификации по протоколу PAP на сторону BE.

Отображение должно содержать набор кнопок, запрашивающий соответствующие данные сос тороны BE для аутентификации по протоколу OAuth. Каждая кнопка должна соответствовать одному из доступных сервисов для аутентификации. Список доступных сервисов должен приходить со стороны BE по соответствующему запросу.

Отображение должно содержать кнопку для перехода на страницу отображения формы регистрации.

При неуспешной аутентификации должно отображаться текстовое сообщение с причиной последней неудачи.

При аутентификации при помощи стороннего сервиса по протоколу OAuth и получении сообщении о необходимости создать нового пользователя, требуется навигироваться на страницу отображения формы регистрации; при этом поля формы регистрации должны быть заполнены на основе данных, полученных из ответа на запрос о неудачной аутентификации.

При успешной аутентификации должна осуществляться на последнию в истории навигации страницу, не являющейся страницей отображения формы аутентификации или формы регистрации, или на страницу отображения навигации по спецификациям.

### STORY: Отображение формы регистрации

Требуется на стороне FE реализовать отображение для обеспечения возможности регистрации пользователя.

Отображение должно содержать набор полей для ввода необходимой для создания на стороне BE пользователя (имя пользователя, имя учетной записи, адрес электронной почты, пароль).

Отображение должно содержать кнопку для передачи данных для создания пользователя на сторону BE.

Отображение должно содержать кнопку для перехода на страницу отображения формы аутентификации.

При неуспешной регистрации должно отображвться текстовое сообщение с причиной последней неудачи.

При успешной регистрации должна осуществляться навигация на последнию в истории навигации страницу, не являющейся страницей отображения формы аутентификации или формы регистрации, или на страницу отображения навигации по спецификациям.

## EPIC: Навигация по имеющимся спецификациям

### STORY: Фильтрация отображаемых спецификаций

### STORY: Навигация между элементами хранилища

### STORY: Отображение хранилища спецификаций

### STORY: Отображение параметров фильрации спецификаций

### STORY: Отображение панели управления

## 

## EPIC: Просмотр спецификаций

Требуется реализовать просмотр хранимой спецификации библиотеки, а именно:
  - Мета-информация спецификации
  - Wiki страница спецификации
  - API спецификации
  - Графическое представление конечно-автоматной процсдуры взаимодействия с библиотекой
  - Текст спецификации на языке LibSL

Каждая спецификация библиотеки имеет свою страницу по аналогии с репозиторием на GitHub и т.п. По умолчанию пользователь открывает последуюю актуальную версию спецификации. Форма страницы сожержит боковую панель с мета-информацией, шапку с названием библиотеки, а также три модальных вкладки с Wiki, API, диаграммами и текстом спецификации. По умолчанию открывается вкладка Wiki.  

### STORY: Отображение мета-информации спецификации

Пользователь хочет провести первую оценку библиотеки, получить общее представление.

Мета-информация должна состоять из следующих данных:
  - Название библиотеки
  - Краткое описание 
  - Автор
  - Дата последнего релиза
  - Список версий/релизов

Название всегда находится в поле зрения, независимо от текущей формы интерфеса. Вся остальная информация также должна быть видима всегда, но занимать боковую часть формы. Список релизов должен быть интерактивным и перенаправлять пользователя на страницу спецификации выбранной версии. Отдельно в списке должен быть выделен последний релиз.

### STORY: Отображение текстового описания спецификации

При открытии страницы спецификации отображается wiki страница, которая содержит описание библиотекти (markdown).

### STORY: Отображение API спецификации

Пользователь хочет просмотреть API, который предоставляет библиотека, в максимально формальном и ёмком виде (API Reference). Раздел представляет собой алфавитный указатель сигнатур функций с кратким описанием назначения, параметров, допустимых состояний для вызова и переходов, сайд-эффектов (изменение глобальных переменных). Также должен быть доступен алфавитный индекс/поиск.

### STORY: Отображение визуализации конечных автоматов спецификаций

Пользователь просматривает диаграмму спецификации библиотеки для того чтобы получить понимание её работы. Визуальное представление спецификации важнее, чем текстовое описание, так как пользователю легче её воспринимать и сразу охвататить всю картину.

Диаграмма занимает основное поле формы интерфейса. Элементы диаграммы интерактивны, их можно перемещать по полю. Переходы между состояниями КА аннотированы названиям функций API, при двойному нажатию на них, производится переход на соответствующее поле в API Reference.

Диаграмма не должна быть перенасыщенной информацией. Диаграмма строится последующим принципам:
  - Элементы одного КА закрашены одним цветом
  - КА подписаны
  - Терминирующие состояния КА выделены цветом и/или контуром
  - Названия состояний подписаны
  - Переходы между состояниями и КА аннотированы названием функции

Отдельно должны быть приведена таблица глобальных переменных с кратким описанием.

### STORY: Отображение содержимого спецификаций

Пользователь хочет просмотреть детали спецификации, такие как типы данных, условия и процедуры инициализации, частичную спецификацию функций.

Для этого ему предоставлсяется текстовое отображение спецификации с подстветкой синтаксиса.

\+ Было бы неплохо отобразить в боковом поле т.н. outline спецификации, то есть иерархический список разделов и элементов, по двойному нажатию на которые производится переход на нужную строку текста. 

## EPIC: Изменение спецификаций

### STORY: Редактирование содержимого спецификации

### STORY: Удаление спецификаций

### STORY: Отображение редактора мета-информации спецификации

### STORY: Отображение редактора содержимого спецификации

### STORY: Проверка авторизации при попытке изменить спецификацию

## EPIC: Импорт спецификаций

### STORY: Отображение окна выбора файлов

### STORY: Загрузка файлов

## EPIC: Развертывание системы

### STORY: Создание docker-compose инфраструктуры

На данный момент планируется деление проекта на три контейнера:

- БД

- Фронтэнд - веб-сервер

- Бэкэнд - реализация бизнес-логики

Для обеспечения взаимодействия контейнеров между собой планируется использование двух внутренних docker-сетей:

- БД-бэкэнд

- бэкэнд-фронтэнд

Следует отметить, что контейнер с веб-сервером должен иметь доступ к внешней сети для протоколов http/https.

### STORY: Настройка веб-сервера

Необходимо обеспечить как сборку проекта с фронтэндом, так и развёртывание артефактов сборки (сайт) на веб-сервере (e.g. Nginx). 

Так как требуется обеспечить подключение как с использованием http, так и с использованием https, необходимо озаботиться сертификатами (использовать let's encrypt). 

### STORY: Настройка бэкэнда

Необходимо обеспечить сборку бэкэнда с использованием выбранной системы сборки (e.g. Gradle) и запуском полученного в результате сборки артефакта.

### STORY: Настройка БД

Необходимо настроить запуск контейнера с БД (e.g. Postgres) с сохранением данных в volume и первичной инициализацией при отсутствии данных (пустом volume). Данные для доступа к БД будут находиться во внешнем .conf-файле и записываться в глобальные переменные бэкэнд-контейнера при его запуске.

### STORY: Настроить CI

В рамках реализации CI необходимо настроить автоматический запуск автотестов при появлении MR или коммите в main и develop-ветки.

### STORY: Настроить CD

Необходимо настроить автосборку контейнера и его выгрузку в docker registry для последующего автоматического обновления на конечном сервере с импользованием watchtower-контейнера.
